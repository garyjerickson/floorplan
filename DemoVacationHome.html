<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!--
    UltraWatch
    Build: DEMO-VACATIONHOME v0.1.0
    Last Updated: 2025-12-30
  -->

  <title>UltraWatch — Vacation Home</title>

  <style>
    :root{
      --bg:#0b1220;
      --panel:rgba(255,255,255,.07);
      --panel2:rgba(255,255,255,.10);
      --text:#e9eefc;
      --muted:rgba(233,238,252,.72);
      --line:rgba(255,255,255,.12);
      --good:#4ade80;
      --warn:#facc15;
      --bad:#fb7185;
      --accent:#60a5fa;
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:var(--bg);
      color:var(--text);
    }
    .wrap{max-width:1200px;margin:0 auto;padding:16px}

    .build{
      background:rgba(96,165,250,.15);
      border:1px solid rgba(96,165,250,.35);
      color:#cfe3ff;
      padding:8px 12px;
      border-radius:12px;
      font-size:12px;
      margin-bottom:12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
    .build b{font-weight:800}

    .header{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:12px;
      margin-bottom:12px;
    }
    h1{margin:0;font-size:20px;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:12px;margin-top:4px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}

    .btn{
      border:1px solid var(--line);
      background:var(--panel2);
      color:var(--text);
      padding:9px 12px;
      border-radius:14px;
      font-weight:700;
      cursor:pointer;
      text-decoration:none;
      user-select:none;
    }
    .btn:hover{filter:brightness(1.08)}
    .btn.danger{
      border-color:rgba(251,113,133,.45);
      background:rgba(251,113,133,.12);
    }

    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
    }
    @media(min-width:980px){
      .grid{grid-template-columns:330px 1.25fr .75fr}
    }

    .card{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:14px;
      overflow:hidden;
    }

    /* Tabs for kids */
    .tabs{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:8px;
    }
    .tab{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.15);
      cursor:pointer;
      font-size:12px;
      color:var(--muted);
      user-select:none;
    }
    .tab.active{
      border-color:rgba(96,165,250,.55);
      background:rgba(96,165,250,.16);
      color:var(--text);
      font-weight:900;
    }

    /* People list */
    .search{
      display:flex;
      gap:8px;
      align-items:center;
      margin-bottom:10px;
    }
    .search input{
      width:100%;
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      color:var(--text);
      border-radius:14px;
      padding:10px 12px;
      outline:none;
    }
    .list{max-height:650px;overflow:auto}
    .person{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding:10px 10px;
      border-bottom:1px solid var(--line);
      cursor:pointer;
    }
    .person:hover{background:rgba(255,255,255,.03)}
    .person.active{background:rgba(96,165,250,.12)}
    .pname{font-weight:900}
    .pmeta{color:var(--muted);font-size:12px;margin-top:2px}

    .badge{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
      height:fit-content;
    }
    .dot{width:9px;height:9px;border-radius:50%;background:var(--good)}
    .dot.warn{background:var(--warn)}
    .dot.bad{background:var(--bad)}

    /* Status row */
    .status{
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:center;
      padding:12px;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.15);
    }
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }

    /* "Property map" panel */
    .property{
      height:420px;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      position:relative;
      overflow:hidden;
      margin-top:12px;
    }

    .zone{
      position:absolute;
      border:2px dashed rgba(96,165,250,.55);
      border-radius:18px;
      padding:10px;
      font-size:12px;
      color:rgba(233,238,252,.8);
      background:rgba(96,165,250,.06);
    }

    .pool{
      border-color:rgba(250,204,21,.65);
      background:rgba(250,204,21,.06);
    }

    .label{
      position:absolute;
      font-size:12px;
      color:rgba(233,238,252,.72);
      padding:6px 10px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.18);
      border-radius:999px;
    }

    .pin{
      position:absolute;
      width:14px;height:14px;border-radius:50%;
      background:var(--good);
      box-shadow:0 0 0 6px rgba(74,222,128,.18);
      transform:translate(-50%,-50%);
    }
    .pin.warn{background:var(--warn);box-shadow:0 0 0 6px rgba(250,204,21,.18)}
    .pin.bad{background:var(--bad);box-shadow:0 0 0 6px rgba(251,113,133,.20)}

    /* Activity */
    .log{max-height:650px;overflow:auto}
    .evt{
      display:flex;justify-content:space-between;gap:12px;
      padding:9px 0;border-bottom:1px solid var(--line);
    }
    .evt .t{font-size:12px;color:var(--muted)}

    /* Alert modal */
    .alert{
      display:none;
      position:fixed;inset:0;
      background:rgba(0,0,0,.7);
      padding:16px;
      z-index:50;
    }
    .alertBox{
      max-width:560px;
      margin:80px auto;
      background:rgba(20,26,40,.98);
      border:1px solid var(--line);
      border-radius:22px;
      padding:16px;
    }
    .alertBox h2{margin:0 0 6px 0}
    .alertBox .sub{margin:0}

    footer{
      margin-top:16px;
      font-size:12px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
  </style>
</head>

<body>
<div class="wrap">

  <div class="build">
    <div><b>UltraWatch</b> — Build <b>DEMO-VACATIONHOME v0.1.0</b></div>
    <div>Updated: <b>Dec 30, 2025</b></div>
  </div>

  <div class="header">
    <div>
      <h1>Vacation Home & Pool Safety</h1>
      <div class="sub">Instant alerts when kids approach the pool • Guest-friendly monitoring • Works with wristbands & room sensors</div>
      <div class="tabs" id="tabs"></div>
    </div>

    <div class="row">
      <a class="btn" href="DemoIndex.html">← Back</a>
      <button class="btn" onclick="simulateMove()">Move</button>
      <button class="btn" onclick="simulatePoolNear()">Near Pool</button>
      <button class="btn danger" onclick="simulatePoolBreach()">Pool Breach</button>
      <button class="btn" onclick="simulateNotSeen()">Not Seen</button>
      <button class="btn danger" onclick="testRandomAlert()">Test Alert</button>
    </div>
  </div>

  <div class="grid">

    <!-- Guest list / kids list -->
    <div class="card">
      <div class="search">
        <input id="search" placeholder="Search guests…" oninput="renderPeople()" />
      </div>
      <div class="sub" style="margin-bottom:10px">Monitored Guests</div>
      <div class="list" id="peopleList"></div>
    </div>

    <!-- Main view -->
    <div class="card">

      <div class="status">
        <div>
          <div id="name" style="font-weight:900;font-size:16px">—</div>
          <div class="sub">
            Wristband <span id="band">—</span> • Last update <span id="lastSeen">—</span> • Sensor <span id="lastSensor">—</span>
          </div>
        </div>
        <div class="row">
          <span class="pill"><span id="stateDot" class="dot"></span><span id="stateText">OK</span></span>
          <span class="pill">Zone: <b id="zone">—</b></span>
          <span class="pill">Status: <b id="statusText">Safe</b></span>
        </div>
      </div>

      <div class="property" id="property">
        <!-- Property labels -->
        <div class="label" style="left:18px;top:14px;">Main House</div>
        <div class="label" style="left:18px;top:46px;">Backyard</div>

        <!-- Zones -->
        <div class="zone" style="left:18px;top:70px;width:56%;height:42%;">House Interior (Rooms)</div>
        <div class="zone" style="left:18px;top:260px;width:56%;height:34%;">Patio / Backyard</div>
        <div class="zone pool" id="poolZone" style="left:63%;top:120px;width:33%;height:44%;">Pool Zone</div>
        <div class="zone" style="left:63%;top:300px;width:33%;height:20%;">Driveway / Front</div>

        <!-- Dot -->
        <div id="pin" class="pin" style="left:40%;top:140%"></div>
      </div>

      <div class="sub" style="margin-top:10px">
        Pool Safety Logic: <b>Near Pool</b> triggers a yellow warning. <b>Pool Breach</b> triggers immediate red alert + audible alarm.
      </div>

    </div>

    <!-- Activity -->
    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:flex-end">
        <div>
          <div style="font-weight:900">Activity</div>
          <div class="sub">Recent events for the selected guest</div>
        </div>
        <button class="btn" onclick="clearActivity()">Clear</button>
      </div>
      <div style="height:10px"></div>
      <div class="log" id="log"></div>
    </div>

  </div>

  <footer>
    <div>UltraWatch © 2025</div>
    <div>Demo Version</div>
  </footer>

</div>

<!-- Alert Modal -->
<div id="alert" class="alert" onclick="dismissAlert()">
  <div class="alertBox" onclick="event.stopPropagation()">
    <h2 id="alertTitle">Alert</h2>
    <p id="alertBody" class="sub">Message</p>
    <div style="height:12px"></div>
    <div class="row" style="justify-content:flex-end">
      <button class="btn" onclick="dismissAlert()">Dismiss</button>
    </div>
  </div>
</div>

<script>
  // ===== Demo people (Vacation Home guests) =====
  const people = [
    { id:"k1", name:"Axel", band:"Wristband A", zone:"House Interior", lastSensor:"Kitchen MK", lastSeenSec:2, state:"ok", status:"Safe", pos:{x:40,y:35} },
    { id:"k2", name:"Minnie", band:"Wristband B", zone:"Patio / Backyard", lastSensor:"Patio MK", lastSeenSec:5, state:"ok", status:"Safe", pos:{x:40,y:72} },
    { id:"k3", name:"Mickey", band:"Wristband C", zone:"House Interior", lastSensor:"Living MK", lastSeenSec:4, state:"ok", status:"Safe", pos:{x:30,y:30} },
    { id:"k4", name:"Sully", band:"Wristband D", zone:"Driveway / Front", lastSensor:"Front MK", lastSeenSec:8, state:"ok", status:"Safe", pos:{x:80,y:82} },
    { id:"k5", name:"Mike", band:"Wristband E", zone:"House Interior", lastSensor:"Hall MK", lastSeenSec:6, state:"ok", status:"Safe", pos:{x:45,y:28} },
  ];

  let selectedId = "k1";

  // ===== Activity per person =====
  const activity = {};
  people.forEach(p => activity[p.id] = [
    { msg:"System online", t:timeNow() },
    { msg:`${p.name} detected — ${p.zone}`, t:timeNow() }
  ]);

  // ===== Alarm audio =====
  let audioCtx = null, osc = null, gain = null, alarmTimer = null;

  function startAlarm(){
    try{
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if(audioCtx.state === "suspended") audioCtx.resume();
      if(alarmTimer) return;

      gain = audioCtx.createGain();
      gain.gain.value = 0.0001;
      gain.connect(audioCtx.destination);

      osc = audioCtx.createOscillator();
      osc.type = "square";
      osc.frequency.value = 880;
      osc.connect(gain);
      osc.start();

      alarmTimer = setInterval(() => {
        const now = audioCtx.currentTime;
        gain.gain.cancelScheduledValues(now);
        gain.gain.setValueAtTime(0.0001, now);
        gain.gain.linearRampToValueAtTime(0.12, now + 0.01);
        gain.gain.linearRampToValueAtTime(0.0001, now + 0.25);
      }, 350);
    }catch(e){ console.log(e); }
  }

  function stopAlarm(){
    try{
      if(alarmTimer){ clearInterval(alarmTimer); alarmTimer = null; }
      if(osc){ osc.stop(); osc.disconnect(); osc = null; }
      if(gain){ gain.disconnect(); gain = null; }
    }catch(e){ console.log(e); }
  }

  // ===== Render =====
  function timeNow(){ return new Date().toLocaleTimeString(); }
  function getSelected(){ return people.find(p => p.id === selectedId); }

  function renderTabs(){
    const tabs = document.getElementById("tabs");
    tabs.innerHTML = "";
    people.forEach(p => {
      const el = document.createElement("div");
      el.className = "tab" + (p.id === selectedId ? " active" : "");
      el.innerHTML = `<span class="dot ${p.state==='warn'?'warn':p.state==='bad'?'bad':''}"></span>${escapeHtml(p.name)}`;
      el.onclick = () => selectPerson(p.id);
      tabs.appendChild(el);
    });
  }

  function renderPeople(){
    const q = (document.getElementById("search").value || "").toLowerCase().trim();
    const list = document.getElementById("peopleList");
    list.innerHTML = "";

    people
      .filter(p => !q || p.name.toLowerCase().includes(q))
      .forEach(p => {
        const el = document.createElement("div");
        el.className = "person" + (p.id === selectedId ? " active" : "");
        const stateDot = p.state === "warn" ? "warn" : p.state === "bad" ? "bad" : "";
        el.innerHTML = `
          <div>
            <div class="pname">${escapeHtml(p.name)}</div>
            <div class="pmeta">${escapeHtml(p.band)} • Last ${p.lastSeenSec}s • ${escapeHtml(p.lastSensor)}</div>
          </div>
          <span class="badge"><span class="dot ${stateDot}"></span>${escapeHtml(p.zone)}</span>
        `;
        el.onclick = () => selectPerson(p.id);
        list.appendChild(el);
      });
  }

  function renderMain(){
    const p = getSelected();
    document.getElementById("name").textContent = p.name;
    document.getElementById("band").textContent = p.band;
    document.getElementById("lastSeen").textContent = p.lastSeenSec + "s ago";
    document.getElementById("lastSensor").textContent = p.lastSensor;
    document.getElementById("zone").textContent = p.zone;
    document.getElementById("statusText").textContent = p.status;

    const sd = document.getElementById("stateDot");
    sd.className = "dot" + (p.state==="warn" ? " warn" : p.state==="bad" ? " bad" : "");
    document.getElementById("stateText").textContent =
      p.state==="ok" ? "OK" : p.state==="warn" ? "WARNING" : "ALERT";

    // pin
    const pin = document.getElementById("pin");
    pin.className = "pin" + (p.state==="warn" ? " warn" : p.state==="bad" ? " bad" : "");
    pin.style.left = p.pos.x + "%";
    pin.style.top = p.pos.y + "%";

    renderActivity();
  }

  function renderActivity(){
    const p = getSelected();
    const log = document.getElementById("log");
    log.innerHTML = "";
    (activity[p.id] || []).slice().reverse().forEach(e => {
      const row = document.createElement("div");
      row.className = "evt";
      row.innerHTML = `<div><b>${escapeHtml(e.msg)}</b></div><div class="t">${escapeHtml(e.t)}</div>`;
      log.appendChild(row);
    });
    log.scrollTop = log.scrollHeight;
  }

  function addEvent(pid, msg){
    if(!activity[pid]) activity[pid] = [];
    activity[pid].push({ msg, t: timeNow() });
  }

  function clearActivity(){
    const p = getSelected();
    activity[p.id] = [];
    addEvent(p.id, "Activity cleared");
    renderActivity();
  }

  function selectPerson(pid){
    selectedId = pid;
    renderTabs();
    renderPeople();
    renderMain();
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, (c) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
    }[c]));
  }

  // ===== Simulations =====
  function simulateMove(){
    const p = getSelected();
    // cycle zones for demo
    const zones = ["House Interior","Patio / Backyard","Pool Zone","Driveway / Front"];
    const idx = Math.max(0, zones.indexOf(p.zone));
    const next = zones[(idx+1) % zones.length];

    p.zone = next;
    p.lastSeenSec = 2;
    p.lastSensor = (next==="House Interior") ? "Kitchen MK" :
                   (next==="Patio / Backyard") ? "Patio MK" :
                   (next==="Pool Zone") ? "Pool MK" : "Front MK";

    // positions
    p.pos = (next==="House Interior") ? {x:40,y:30} :
            (next==="Patio / Backyard") ? {x:40,y:74} :
            (next==="Pool Zone") ? {x:80,y:40} : {x:80,y:82};

    // reset states
    p.state = "ok"; p.status = "Safe";
    addEvent(p.id, "Zone update — " + next);
    renderTabs(); renderPeople(); renderMain();
  }

  function simulatePoolNear(){
    const p = getSelected();
    p.zone = "Pool Zone";
    p.lastSensor = "Pool MK";
    p.pos = {x:80,y:42};
    p.state = "warn";
    p.status = "Near Pool";
    addEvent(p.id, "Pool proximity warning");
    showAlert("Pool Proximity Warning", `${p.name} is near the pool. Caregiver notified.`);
    renderTabs(); renderPeople(); renderMain();
  }

  function simulatePoolBreach(){
    const p = getSelected();
    p.zone = "Pool Zone";
    p.lastSensor = "Pool MK";
    p.pos = {x:82,y:38};
    p.state = "bad";
    p.status = "POOL BREACH";
    addEvent(p.id, "Pool breach — immediate alert");
    showAlert("Pool Alert", `${p.name} entered the pool zone. Alarm triggered.`);
    startAlarm();
    renderTabs(); renderPeople(); renderMain();
  }

  function simulateNotSeen(){
    const p = getSelected();
    p.lastSeenSec = 45;
    p.state = "warn";
    p.status = "Not Detected";
    addEvent(p.id, "Wristband not detected — check location");
    showAlert("Not Detected", `${p.name} has not been detected recently. Check the property.`);
    renderTabs(); renderPeople(); renderMain();
  }

  function testRandomAlert(){
    const r = people[Math.floor(Math.random()*people.length)];
    selectedId = r.id;

    const type = Math.floor(Math.random()*3);
    if(type===0) simulatePoolNear();
    else if(type===1) simulatePoolBreach();
    else simulateNotSeen();
  }

  // ===== Alert modal =====
  function showAlert(title, body){
    document.getElementById("alertTitle").textContent = title;
    document.getElementById("alertBody").textContent = body;
    document.getElementById("alert").style.display = "block";
  }
  function dismissAlert(){
    document.getElementById("alert").style.display = "none";
    stopAlarm();
  }

  // ===== Live feel =====
  setInterval(() => {
    people.forEach(p => p.lastSeenSec = Math.min(999, p.lastSeenSec + 1));
    renderTabs();
    renderPeople();
    renderMain();
  }, 3000);

  // init
  renderTabs();
  renderPeople();
  renderMain();
</script>

</body>
</html>
