<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!--
    UltraWatch
    Build: DEMO-ELDERLY v0.2.0
    Last Updated: 2025-12-30
  -->

  <title>UltraWatch — Elderly Care</title>

  <style>
    :root{
      --bg:#0b1220;
      --panel:rgba(255,255,255,.07);
      --panel2:rgba(255,255,255,.10);
      --text:#e9eefc;
      --muted:rgba(233,238,252,.72);
      --line:rgba(255,255,255,.12);
      --good:#4ade80;
      --warn:#facc15;
      --bad:#fb7185;
      --accent:#60a5fa;
      --radius:18px;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:var(--bg);
      color:var(--text);
    }

    .wrap{max-width:1200px;margin:0 auto;padding:16px}

    /* ===== Build Banner (internal) ===== */
    .build{
      background:rgba(96,165,250,.15);
      border:1px solid rgba(96,165,250,.35);
      color:#cfe3ff;
      padding:8px 12px;
      border-radius:12px;
      font-size:12px;
      margin-bottom:12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
    .build b{font-weight:800}

    /* ===== Header ===== */
    .header{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:12px;
      margin-bottom:12px;
    }
    h1{margin:0;font-size:20px;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:12px;margin-top:4px}

    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}

    .btn{
      border:1px solid var(--line);
      background:var(--panel2);
      color:var(--text);
      padding:9px 12px;
      border-radius:14px;
      font-weight:700;
      cursor:pointer;
      text-decoration:none;
      user-select:none;
    }
    .btn:hover{filter:brightness(1.08)}

    .btn.danger{
      border-color:rgba(251,113,133,.45);
      background:rgba(251,113,133,.12);
    }

    /* ===== Layout ===== */
    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
    }
    @media(min-width:980px){
      .grid{grid-template-columns:320px 1.25fr .75fr}
    }

    .card{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:14px;
      overflow:hidden;
    }

    /* ===== Tabs (quick people) ===== */
    .tabs{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:8px;
    }
    .tab{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.15);
      cursor:pointer;
      font-size:12px;
      color:var(--muted);
      user-select:none;
    }
    .tab.active{
      border-color:rgba(96,165,250,.55);
      background:rgba(96,165,250,.16);
      color:var(--text);
    }

    /* ===== People list ===== */
    .search{
      display:flex;
      gap:8px;
      align-items:center;
      margin-bottom:10px;
    }
    .search input{
      width:100%;
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      color:var(--text);
      border-radius:14px;
      padding:10px 12px;
      outline:none;
    }
    .list{max-height:620px;overflow:auto}
    .person{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding:10px 10px;
      border-bottom:1px solid var(--line);
      cursor:pointer;
    }
    .person:hover{background:rgba(255,255,255,.03)}
    .person.active{background:rgba(96,165,250,.12)}
    .pname{font-weight:800}
    .pmeta{color:var(--muted);font-size:12px;margin-top:2px}
    .badge{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
      height:fit-content;
    }
    .dot{width:9px;height:9px;border-radius:50%;background:var(--good)}
    .dot.warn{background:var(--warn)}
    .dot.bad{background:var(--bad)}

    /* ===== Status / Pills ===== */
    .status{
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:center;
      padding:12px;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.15);
    }
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }

    /* ===== Floor / Map ===== */
    .floor,.map{
      height:360px;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      position:relative;
      overflow:hidden;
      margin-top:12px;
    }
    .room{
      position:absolute;
      border:1px dashed rgba(255,255,255,.25);
      border-radius:14px;
      padding:8px 10px;
      font-size:12px;
      color:var(--muted);
    }
    .pin{
      position:absolute;
      width:14px;height:14px;border-radius:50%;
      background:var(--good);
      box-shadow:0 0 0 6px rgba(74,222,128,.18);
    }
    .pin.warn{background:var(--warn);box-shadow:0 0 0 6px rgba(250,204,21,.18)}
    .pin.bad{background:var(--bad);box-shadow:0 0 0 6px rgba(251,113,133,.20)}
    .mapTag{
      position:absolute;left:12px;top:12px;
      display:inline-flex;gap:8px;align-items:center;
      padding:6px 10px;border-radius:999px;border:1px solid var(--line);
      font-size:12px;color:var(--muted);background:rgba(0,0,0,.18);
    }

    /* ===== Activity ===== */
    .log{max-height:620px;overflow:auto}
    .evt{
      display:flex;justify-content:space-between;gap:12px;
      padding:9px 0;border-bottom:1px solid var(--line);
    }
    .evt .t{font-size:12px;color:var(--muted)}

    /* ===== Alert Modal ===== */
    .alert{
      display:none;
      position:fixed;inset:0;
      background:rgba(0,0,0,.7);
      padding:16px;
      z-index:50;
    }
    .alertBox{
      max-width:560px;
      margin:80px auto;
      background:rgba(20,26,40,.98);
      border:1px solid var(--line);
      border-radius:22px;
      padding:16px;
    }
    .alertBox h2{margin:0 0 6px 0}
    .alertBox .sub{margin:0}

    footer{
      margin-top:16px;
      font-size:12px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
  </style>
</head>

<body>
<div class="wrap">

  <!-- Build Banner (your internal reference) -->
  <div class="build">
    <div><b>UltraWatch</b> — Build <b>DEMO-ELDERLY v0.2.0</b></div>
    <div>Updated: <b>Dec 30, 2025</b></div>
  </div>

  <!-- Header -->
  <div class="header">
    <div>
      <h1>Elderly Care Dashboard</h1>
      <div class="sub">In-home awareness, safety alerts, and caregiver confidence</div>

      <!-- Quick tabs -->
      <div class="tabs" id="tabs"></div>
    </div>

    <div class="row">
      <a class="btn" href="DemoIndex.html">← Back</a>
      <button class="btn" onclick="simulateMove()">Move Room</button>
      <button class="btn" onclick="simulateLinger()">Linger</button>
      <button class="btn danger" onclick="simulateSOS()">SOS</button>
      <button class="btn" onclick="simulateNotSeen()">Not Seen</button>
      <button class="btn danger" onclick="testSOS()">Test SOS</button>
    </div>
  </div>

  <div class="grid">

    <!-- People List -->
    <div class="card">
      <div class="search">
        <input id="search" placeholder="Search people…" oninput="renderPeople()" />
      </div>
      <div class="sub" style="margin-bottom:10px">Monitored People</div>
      <div class="list" id="peopleList"></div>
    </div>

    <!-- Main View -->
    <div class="card">

      <div class="status">
        <div>
          <div id="name" style="font-weight:900;font-size:16px">—</div>
          <div class="sub">
            Battery <span id="battery">—</span> • Last update <span id="lastSeen">—</span> • Last sensor <span id="lastSensor">—</span>
          </div>
        </div>
        <div class="row">
          <span class="pill"><span id="stateDot" class="dot"></span><span id="stateText">OK</span></span>
          <span class="pill">Status: <b id="statusText">Home</b></span>
          <span class="pill">Room: <b id="room">—</b></span>
          <span class="pill">Time: <b id="time">—</b></span>
        </div>
      </div>

      <div id="floor" class="floor">
        <div class="room" style="left:18px;top:18px;width:42%;height:28%">Bedroom</div>
        <div class="room" style="left:52%;top:18px;width:40%;height:28%">Bathroom</div>
        <div class="room" style="left:18px;top:54%;width:42%;height:40%">Living Room</div>
        <div class="room" style="left:52%;top:54%;width:40%;height:40%">Kitchen</div>
        <div class="room" style="left:38%;top:46%;width:24%;height:8%;text-align:center">Front Door</div>
        <div id="pin" class="pin" style="left:72%;top:76%"></div>
      </div>

      <div id="map" class="map" style="display:none">
        <div class="mapTag">Map View</div>
        <div id="gpsPin" class="pin" style="left:64%;top:56%"></div>
      </div>

    </div>

    <!-- Activity -->
    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:flex-end">
        <div>
          <div style="font-weight:900">Activity</div>
          <div class="sub">Recent events for the selected person</div>
        </div>
        <button class="btn" onclick="clearActivity()">Clear</button>
      </div>
      <div style="height:10px"></div>
      <div class="log" id="log"></div>
    </div>

  </div>

  <footer>
    <div>UltraWatch © 2025</div>
    <div>Demo Version</div>
  </footer>

</div>

<!-- Alert Modal -->
<div id="alert" class="alert" onclick="dismissAlert()">
  <div class="alertBox" onclick="event.stopPropagation()">
    <h2 id="alertTitle">Alert</h2>
    <p id="alertBody" class="sub">Message</p>
    <div style="height:12px"></div>
    <div class="row" style="justify-content:flex-end">
      <button class="btn" onclick="dismissAlert()">Dismiss</button>
    </div>
  </div>
</div>

<script>
  // =========================
  // Demo Data
  // =========================
  const ROOMS = ["Kitchen","Living Room","Bathroom","Bedroom","Front Door"];
  const ROOM_POS = {
    "Bedroom": {l:"28%",t:"24%"},
    "Bathroom": {l:"72%",t:"24%"},
    "Living Room": {l:"28%",t:"76%"},
    "Kitchen": {l:"72%",t:"76%"},
    "Front Door": {l:"50%",t:"49%"},
    "": {l:"50%",t:"49%"}
  };

  // 20 monitored people (editable)
  const people = [
    { id:"p1", name:"Jack Erickson", room:"Kitchen", lastSensor:"Kitchen", battery:82, status:"Home", state:"ok", lastSeenSec:2, timeInRoom:"00:12:43" },
    { id:"p2", name:"Christine Visalli", room:"Living Room", lastSensor:"Living Room", battery:76, status:"Home", state:"ok", lastSeenSec:4, timeInRoom:"00:08:19" },
    { id:"p3", name:"Dail Skogstrom", room:"Bedroom", lastSensor:"Bedroom", battery:64, status:"Home", state:"ok", lastSeenSec:7, timeInRoom:"01:02:11" },
    { id:"p4", name:"Amada Morales", room:"Bathroom", lastSensor:"Bathroom", battery:71, status:"Home", state:"ok", lastSeenSec:3, timeInRoom:"00:04:52" },

    { id:"p5", name:"Evelyn Carter", room:"Kitchen", lastSensor:"Kitchen", battery:89, status:"Home", state:"ok", lastSeenSec:5, timeInRoom:"00:20:06" },
    { id:"p6", name:"Harold Bennett", room:"Living Room", lastSensor:"Living Room", battery:58, status:"Home", state:"ok", lastSeenSec:8, timeInRoom:"00:31:44" },
    { id:"p7", name:"Rosa Delgado", room:"Bedroom", lastSensor:"Bedroom", battery:80, status:"Home", state:"ok", lastSeenSec:6, timeInRoom:"02:10:03" },
    { id:"p8", name:"Stanley Young", room:"Kitchen", lastSensor:"Kitchen", battery:67, status:"Home", state:"ok", lastSeenSec:9, timeInRoom:"00:14:28" },
    { id:"p9", name:"Martha Price", room:"Living Room", lastSensor:"Living Room", battery:73, status:"Home", state:"ok", lastSeenSec:3, timeInRoom:"00:45:10" },
    { id:"p10", name:"Arthur Lee", room:"Bedroom", lastSensor:"Bedroom", battery:61, status:"Home", state:"ok", lastSeenSec:12, timeInRoom:"00:22:18" },
    { id:"p11", name:"Nina Kim", room:"Kitchen", lastSensor:"Kitchen", battery:86, status:"Home", state:"ok", lastSeenSec:4, timeInRoom:"00:07:53" },
    { id:"p12", name:"Frank Owens", room:"Living Room", lastSensor:"Living Room", battery:69, status:"Home", state:"ok", lastSeenSec:10, timeInRoom:"00:11:02" },
    { id:"p13", name:"Olivia Stone", room:"Bathroom", lastSensor:"Bathroom", battery:78, status:"Home", state:"ok", lastSeenSec:6, timeInRoom:"00:03:37" },
    { id:"p14", name:"Paul Rivera", room:"Kitchen", lastSensor:"Kitchen", battery:55, status:"Home", state:"ok", lastSeenSec:14, timeInRoom:"00:05:49" },
    { id:"p15", name:"Linda Chavez", room:"Bedroom", lastSensor:"Bedroom", battery:83, status:"Home", state:"ok", lastSeenSec:7, timeInRoom:"01:18:00" },
    { id:"p16", name:"George Miles", room:"Living Room", lastSensor:"Living Room", battery:62, status:"Home", state:"ok", lastSeenSec:5, timeInRoom:"00:09:14" },
    { id:"p17", name:"Patricia Hall", room:"Kitchen", lastSensor:"Kitchen", battery:90, status:"Home", state:"ok", lastSeenSec:2, timeInRoom:"00:16:31" },
    { id:"p18", name:"Victor Nguyen", room:"Bathroom", lastSensor:"Bathroom", battery:74, status:"Home", state:"ok", lastSeenSec:6, timeInRoom:"00:02:22" },
    { id:"p19", name:"Teresa Brooks", room:"Living Room", lastSensor:"Living Room", battery:68, status:"Home", state:"ok", lastSeenSec:11, timeInRoom:"00:40:05" },
    { id:"p20", name:"Samuel Wright", room:"Kitchen", lastSensor:"Kitchen", battery:77, status:"Home", state:"ok", lastSeenSec:9, timeInRoom:"00:13:09" },
  ];

  // Selected person
  let selectedId = "p1";

  // Activity per person
  const activity = {};
  people.forEach(p => activity[p.id] = [
    { msg:"System online", t:timeNow() },
    { msg:`${p.name} detected — ${p.room}`, t:timeNow() }
  ]);

  // =========================
  // Alarm (audible)
  // =========================
  // Uses Web Audio API; sound will play after a user gesture (button click), which our buttons provide.
  let audioCtx = null;
  let osc = null;
  let gain = null;
  let alarmTimer = null;

  function startAlarm(){
    try{
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if(audioCtx.state === "suspended") audioCtx.resume();

      // If already running, do nothing
      if(alarmTimer) return;

      gain = audioCtx.createGain();
      gain.gain.value = 0.0001;
      gain.connect(audioCtx.destination);

      osc = audioCtx.createOscillator();
      osc.type = "square";
      osc.frequency.value = 880;
      osc.connect(gain);
      osc.start();

      // Pulse the gain to create beeps
      alarmTimer = setInterval(() => {
        const now = audioCtx.currentTime;
        gain.gain.cancelScheduledValues(now);
        gain.gain.setValueAtTime(0.0001, now);
        gain.gain.linearRampToValueAtTime(0.12, now + 0.01);
        gain.gain.linearRampToValueAtTime(0.0001, now + 0.25);
      }, 350);
    }catch(e){
      console.log("Alarm audio error:", e);
    }
  }

  function stopAlarm(){
    try{
      if(alarmTimer){ clearInterval(alarmTimer); alarmTimer = null; }
      if(osc){ osc.stop(); osc.disconnect(); osc = null; }
      if(gain){ gain.disconnect(); gain = null; }
    }catch(e){
      console.log("Stop alarm error:", e);
    }
  }

  // =========================
  // Rendering
  // =========================
  function timeNow(){
    return new Date().toLocaleTimeString();
  }

  function getSelected(){
    return people.find(p => p.id === selectedId);
  }

  function renderTabs(){
    const tabs = document.getElementById("tabs");
    tabs.innerHTML = "";
    // Show first 6 as quick tabs (you can change this)
    const quick = people.slice(0, 6);
    quick.forEach(p => {
      const el = document.createElement("div");
      el.className = "tab" + (p.id === selectedId ? " active" : "");
      el.innerHTML = `<span class="dot ${p.state==='warn'?'warn':p.state==='bad'?'bad':''}"></span>${escapeHtml(p.name)}`;
      el.onclick = () => selectPerson(p.id);
      tabs.appendChild(el);
    });
  }

  function renderPeople(){
    const q = (document.getElementById("search").value || "").toLowerCase().trim();
    const list = document.getElementById("peopleList");
    list.innerHTML = "";

    people
      .filter(p => !q || p.name.toLowerCase().includes(q))
      .forEach(p => {
        const el = document.createElement("div");
        el.className = "person" + (p.id === selectedId ? " active" : "");
        const stateDot = p.state === "warn" ? "warn" : p.state === "bad" ? "bad" : "";
        const right = (p.status === "Left Home")
          ? `<span class="badge"><span class="dot ${stateDot}"></span>Left Home</span>`
          : `<span class="badge"><span class="dot ${stateDot}"></span>${escapeHtml(p.room || "—")}</span>`;

        el.innerHTML = `
          <div>
            <div class="pname">${escapeHtml(p.name)}</div>
            <div class="pmeta">Battery ${p.battery}% • Last ${p.lastSeenSec}s • Sensor ${escapeHtml(p.lastSensor || "—")}</div>
          </div>
          ${right}
        `;
        el.onclick = () => selectPerson(p.id);
        list.appendChild(el);
      });
  }

  function renderMain(){
    const p = getSelected();
    document.getElementById("name").textContent = p.name;
    document.getElementById("battery").textContent = p.battery + "%";
    document.getElementById("lastSeen").textContent = p.lastSeenSec + "s ago";
    document.getElementById("lastSensor").textContent = p.lastSensor || "—";
    document.getElementById("room").textContent = p.room || "—";
    document.getElementById("time").textContent = p.timeInRoom || "—";
    document.getElementById("statusText").textContent = p.status;

    // state dot
    const sd = document.getElementById("stateDot");
    sd.className = "dot" + (p.state==="warn" ? " warn" : p.state==="bad" ? " bad" : "");
    document.getElementById("stateText").textContent =
      p.state==="ok" ? "OK" : p.state==="warn" ? "LINGER" : "ALERT";

    // pin + view
    const pin = document.getElementById("pin");
    pin.className = "pin" + (p.state==="warn" ? " warn" : p.state==="bad" ? " bad" : "");

    if(p.status === "Left Home" || (p.lastSeenSec >= 30 && p.lastSensor === "Front Door")){
      // show map for left home (or timeout + front door rule)
      document.getElementById("floor").style.display = "none";
      document.getElementById("map").style.display = "block";
    }else{
      document.getElementById("floor").style.display = "block";
      document.getElementById("map").style.display = "none";
    }

    const pos = ROOM_POS[p.room || ""] || ROOM_POS[""];
    pin.style.left = pos.l;
    pin.style.top = pos.t;

    renderActivity();
  }

  function renderActivity(){
    const p = getSelected();
    const log = document.getElementById("log");
    log.innerHTML = "";
    (activity[p.id] || []).slice().reverse().forEach(e => {
      const row = document.createElement("div");
      row.className = "evt";
      row.innerHTML = `<div><b>${escapeHtml(e.msg)}</b></div><div class="t">${escapeHtml(e.t)}</div>`;
      log.appendChild(row);
    });
    // scroll to bottom (latest at bottom)
    log.scrollTop = log.scrollHeight;
  }

  function addEvent(pid, msg){
    if(!activity[pid]) activity[pid] = [];
    activity[pid].push({ msg, t: timeNow() });
  }

  function selectPerson(pid){
    selectedId = pid;
    renderTabs();
    renderPeople();
    renderMain();
  }

  function clearActivity(){
    const p = getSelected();
    activity[p.id] = [];
    addEvent(p.id, "Activity cleared");
    renderActivity();
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, (c) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
    }[c]));
  }

  // =========================
  // Simulations
  // =========================
  function simulateMove(){
    const p = getSelected();
    if(p.status === "Left Home"){
      // bring them back home
      p.status = "Home";
      p.lastSeenSec = 2;
      p.lastSensor = "Front Door";
      p.room = "Front Door";
      p.timeInRoom = "00:00:02";
      addEvent(p.id, "Returned home — Front Door");
      renderTabs(); renderPeople(); renderMain();
      return;
    }

    // move to next room
    const i = Math.max(0, ROOMS.indexOf(p.room));
    const next = ROOMS[(i + 1) % ROOMS.length];
    p.room = next;
    p.lastSensor = next;
    p.lastSeenSec = 2;
    p.timeInRoom = "00:00:05";
    p.state = "ok";
    addEvent(p.id, "Room update — " + next);
    renderTabs(); renderPeople(); renderMain();
  }

  function simulateLinger(){
    const p = getSelected();
    p.state = "warn";
    addEvent(p.id, "Linger alert triggered");
    showAlert("Linger Alert", `${p.name} has remained in ${p.room} longer than expected.`);
    startAlarm();
    renderTabs(); renderPeople(); renderMain();
  }

  function simulateSOS(){
    const p = getSelected();
    triggerSOSFor(p.id);
  }

  // Not Seen: increments "last seen", applies "Left Home" rule if last sensor was Front Door
  function simulateNotSeen(){
    const p = getSelected();
    // simulate a timeout event
    p.lastSeenSec = 45;

    if(p.lastSensor === "Front Door"){
      p.status = "Left Home";
      p.room = "";
      addEvent(p.id, "Not detected after Front Door — marked as Left Home");
    }else{
      p.state = "warn";
      addEvent(p.id, "Beacon not detected — switching to map view");
    }

    renderTabs(); renderPeople(); renderMain();
  }

  function triggerSOSFor(pid){
    const p = people.find(x => x.id === pid);
    p.state = "bad";
    p.status = (p.status === "Left Home") ? "Left Home" : "Home";
    addEvent(pid, "Emergency alert — SOS triggered");
    // Switch to that person
    selectedId = pid;
    renderTabs(); renderPeople(); renderMain();
    showAlert("Emergency Alert", `SOS triggered for ${p.name}. Caregiver notified.`);
    startAlarm();
  }

  // Random SOS for any person
  function testSOS(){
    const idx = Math.floor(Math.random() * people.length);
    triggerSOSFor(people[idx].id);
  }

  // =========================
  // Alert modal
  // =========================
  function showAlert(title, body){
    document.getElementById("alertTitle").textContent = title;
    document.getElementById("alertBody").textContent = body;
    document.getElementById("alert").style.display = "block";
  }

  function dismissAlert(){
    document.getElementById("alert").style.display = "none";
    stopAlarm();
  }

  // =========================
  // Lightweight "live" feel: tick lastSeen counters
  // =========================
  setInterval(() => {
    people.forEach(p => {
      // If not in active alert, we gently tick
      p.lastSeenSec = Math.min(999, p.lastSeenSec + 1);
      // Keep Left Home as stable
      if(p.status === "Left Home"){
        p.room = "";
      }
    });

    // render only the visible parts (fast enough for demo)
    renderTabs();
    renderPeople();
    renderMain();
  }, 3000);

  // Initial render
  renderTabs();
  renderPeople();
  renderMain();
</script>

</body>
</html>
